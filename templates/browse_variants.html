{% extends "base.html" %}
{% load staticfiles %}

{% block includes %}
<link rel="stylesheet" type="text/css" href="{% static 'browse/css/unitip.css' %}" />
<script type="text/javascript" src="{% static 'browse/js/unitip.js' %}"></script>
<script type="text/javascript">
  $(document).ready(function(){
    $.ajax({
      url:"{% static tree_url %}",
      dataType: "xml",
      success: function(data) {
        console.log(data)
        var dataObject = {
          xml: data,
          fileSource: true
        };     

        phylocanvas = new Smits.PhyloCanvas(
          dataObject,
          'tree',
          800, 800,
          'circular'
        );

        init(); //unitip

        treediv = $("#tree");
        treediv.width(800);
        treediv.height(800);
      },
      error: function(jqXHR, textStatus, errorThrown) {
        console.log(textStatus);
        console.log(errorThrown)
      }
    });
 });
</script>
{% endblock %}

{% block content %}
<div class="container" style="margin-top:30px;">
  <div class="row">
    <div class="col-xs-3">
      <img src="{% with 'browse/img/'|add:histone_type|add:'.png' as image_static %}{% static image_static %}{% endwith %}" width="75%" />
    </div>
    <div class="col-xs-9">
      <div class="row">
        <div class="col-xs-12">
          <h1>{{ histone_type }}</h1>
        </div>
        <div class="col-xs-12">
          {{ histone_description }}
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12">
      <div role="tabpanel">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active"><a href="#variant" aria-controls="variant" role="tab" data-toggle="tab">By Variant</a></li>
          <li role="presentation"><a href="#sequences" aria-controls="sequences" role="tab" data-toggle="tab">All Sequences</a></li>
          <li role="presentation"><a href="#seed" aria-controls="seed" role="tab" data-toggle="tab">Seed Alignments</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="variant">
            <div class="row">
              <div class="col-xs-8">
                <div id="tree"></div>
              </div>
              <div class="col-xs-4">
                <div class="row center-block">
                  <div class="col-xs-12">
                    <h4>Known Variants:</h4>
                    <div class="list-group">
                      {% for variant, num_sequences, color in variants %}
                        <a class="list-group-item"
                           href="{% url 'browse.views.browse_variant' histone_type variant %}">
                          <span class="badge" style="background-color:{{ color }};">{{ num_sequences }}</span>
                          {{ variant }}  
                        </a>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div role="tabpanel" class="tab-pane" id="sequences">
            {% include "test.html" %} 
          </div>
          <div role="tabpanel" class="tab-pane" id="seed">
            {% include "seed.html" %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
